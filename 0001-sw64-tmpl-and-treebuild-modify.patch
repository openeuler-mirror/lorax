From 068f08269167a1f03612ed5b2b14c943e165b471 Mon Sep 17 00:00:00 2001
From: isoft <wenjuan.qiu@i-soft.com.cn>
Date: Wed, 2 Nov 2022 07:51:28 +0000
Subject: [PATCH] sw64 tmpl and treebuild modify

---
 share/templates.d/99-generic/sw64.tmpl | 2 --
 src/pylorax/treebuilder.py             | 4 ++--
 2 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/share/templates.d/99-generic/sw64.tmpl b/share/templates.d/99-generic/sw64.tmpl
index 3830f2e..9996923 100644
--- a/share/templates.d/99-generic/sw64.tmpl
+++ b/share/templates.d/99-generic/sw64.tmpl
@@ -54,8 +54,6 @@ install ${configdir}/boot/grub/splash.xpm.gz  ${BOOTDIR}/grub/
 install ${configdir}/boot/grub/fonts/unicode.pf2       ${BOOTDIR}/grub/fonts/
 install ${configdir}/boot/grub/locale/zh_CN.mo         ${BOOTDIR}/grub/locale/
 
-ln -s ${BOOTDIR}/boot .
-
 %for kernel in kernels:
     %if kernel.flavor:
         ## i386 PAE
diff --git a/src/pylorax/treebuilder.py b/src/pylorax/treebuilder.py
index 5fbb579..cead5b2 100644
--- a/src/pylorax/treebuilder.py
+++ b/src/pylorax/treebuilder.py
@@ -246,7 +246,7 @@ class RuntimeBuilder(object):
 
         # Catch problems with the rootfs being too small and clearly log them
         try:
-            imgutils.mkrootfsimg(self.vars.root, joinpaths(workdir, "rootfs.img"),
+            imgutils.mkrootfsimg(self.vars.root, joinpaths(workdir, "root-image.fs"),
                                  "Anaconda", size=size)
         except CalledProcessError as e:
             if e.stdout and "No space left on device" in e.stdout:
@@ -254,7 +254,7 @@ class RuntimeBuilder(object):
             raise
 
         # squash the live rootfs and clean up workdir
-        rc = imgutils.mksquashfs(workdir, outfile, compression, compressargs)
+        rc = imgutils.mksquashfs(joinpaths(workdir, "root-image.fs"), outfile, compression, compressargs)
         remove(workdir)
         return rc
 
-- 
2.33.0

